{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Event Bank\n",
    "\n",
    "The EventBank class is used to interact with a local directory of event files.  The `get_events` method of Event Bank are compatible with the `get_events` method of the FDSN client in obspy. Additionally there are several useful features for managing events on disk.  \n",
    "\n",
    "\n",
    "## Quickstart"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:11.109809Z",
     "iopub.status.busy": "2025-01-03T23:13:11.109364Z",
     "iopub.status.idle": "2025-01-03T23:13:12.084966Z",
     "shell.execute_reply": "2025-01-03T23:13:12.084527Z"
    }
   },
   "outputs": [],
   "source": [
    "import obspy\n",
    "\n",
    "import obsplus"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:12.087143Z",
     "iopub.status.busy": "2025-01-03T23:13:12.086604Z",
     "iopub.status.idle": "2025-01-03T23:13:12.186270Z",
     "shell.execute_reply": "2025-01-03T23:13:12.185753Z"
    }
   },
   "outputs": [],
   "source": [
    "%%capture\n",
    "# make sure the dataset is downloaded and supress output.\n",
    "obsplus.load_dataset(\"crandall_test\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:12.188143Z",
     "iopub.status.busy": "2025-01-03T23:13:12.187798Z",
     "iopub.status.idle": "2025-01-03T23:13:12.241959Z",
     "shell.execute_reply": "2025-01-03T23:13:12.241456Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "EventBank(base_path=/tmp/tmpk7ti2wd9/crandall_test/events, index_path=/tmp/tmpk7ti2wd9/crandall_test/events/.index.db)"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# copy the Crandall dataset to a temporary directory\n",
    "crandall = obsplus.copy_dataset(\"crandall_test\")\n",
    "\n",
    "# path to directory where events are stored\n",
    "event_path = crandall.event_path\n",
    "\n",
    "# init an EventBank instance\n",
    "bank = obsplus.EventBank(event_path)\n",
    "\n",
    "# ensure index is up-to-date\n",
    "bank.update_index()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Accessing the index \n",
    "The index can be accessed directly to get a summary of the events contained in the archive. Depending on the task, it may be more natural to work with the index dataframe rather than the obspy catalog objects directly."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:12.270206Z",
     "iopub.status.busy": "2025-01-03T23:13:12.269810Z",
     "iopub.status.idle": "2025-01-03T23:13:12.296811Z",
     "shell.execute_reply": "2025-01-03T23:13:12.296314Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>time</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>depth</th>\n",
       "      <th>magnitude</th>\n",
       "      <th>event_description</th>\n",
       "      <th>associated_phase_count</th>\n",
       "      <th>azimuthal_gap</th>\n",
       "      <th>event_id</th>\n",
       "      <th>horizontal_uncertainty</th>\n",
       "      <th>...</th>\n",
       "      <th>standard_error</th>\n",
       "      <th>used_phase_count</th>\n",
       "      <th>station_count</th>\n",
       "      <th>vertical_uncertainty</th>\n",
       "      <th>updated</th>\n",
       "      <th>author</th>\n",
       "      <th>agency_id</th>\n",
       "      <th>creation_time</th>\n",
       "      <th>version</th>\n",
       "      <th>path</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2007-08-06 01:44:48.810</td>\n",
       "      <td>39.4617</td>\n",
       "      <td>-111.2378</td>\n",
       "      <td>6570.0</td>\n",
       "      <td>1.78</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248828</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.8936</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.512233984</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 20:26:49.642650</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/06/2007-08-06T01-44-48_48828.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2007-08-06 10:47:25.600</td>\n",
       "      <td>39.4615</td>\n",
       "      <td>-111.2317</td>\n",
       "      <td>2050.0</td>\n",
       "      <td>1.57</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248843</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.8237</td>\n",
       "      <td>0.0</td>\n",
       "      <td>29.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 20:33:27.110914</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/06/2007-08-06T10-47-25_48843.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2007-08-06 08:48:40.010</td>\n",
       "      <td>39.4635</td>\n",
       "      <td>-111.2277</td>\n",
       "      <td>410.0</td>\n",
       "      <td>4.37</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248839</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>1.7356</td>\n",
       "      <td>0.0</td>\n",
       "      <td>134.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 20:33:13.618111</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/06/2007-08-06T08-48-40_48839.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2007-08-07 21:42:51.130</td>\n",
       "      <td>39.4627</td>\n",
       "      <td>-111.2200</td>\n",
       "      <td>4620.0</td>\n",
       "      <td>1.65</td>\n",
       "      <td></td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248925</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.5704</td>\n",
       "      <td>0.0</td>\n",
       "      <td>19.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.514234112</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-11 22:08:54.236916</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T21-42-51_48925.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2007-08-07 07:13:05.760</td>\n",
       "      <td>39.4605</td>\n",
       "      <td>-111.2242</td>\n",
       "      <td>3240.0</td>\n",
       "      <td>2.24</td>\n",
       "      <td></td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248891</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.9901</td>\n",
       "      <td>0.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>NaT</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T07-13-05_48891.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2007-08-07 02:05:04.490</td>\n",
       "      <td>39.4648</td>\n",
       "      <td>-111.2255</td>\n",
       "      <td>1790.0</td>\n",
       "      <td>2.08</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248882</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.9935</td>\n",
       "      <td>0.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 21:15:19.190404</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T02-05-04_48882.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2007-08-07 02:14:24.080</td>\n",
       "      <td>39.4632</td>\n",
       "      <td>-111.2230</td>\n",
       "      <td>4180.0</td>\n",
       "      <td>1.26</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248883</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.8834</td>\n",
       "      <td>0.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 21:10:26.864045</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T02-14-24_48883.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2007-08-07 03:44:18.470</td>\n",
       "      <td>39.4625</td>\n",
       "      <td>-111.2152</td>\n",
       "      <td>4160.0</td>\n",
       "      <td>1.45</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248887</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.5716</td>\n",
       "      <td>0.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 21:10:27.576204</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T03-44-18_48887.xml</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>8 rows × 28 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                     time  latitude  longitude   depth  magnitude  \\\n",
       "0 2007-08-06 01:44:48.810   39.4617  -111.2378  6570.0       1.78   \n",
       "1 2007-08-06 10:47:25.600   39.4615  -111.2317  2050.0       1.57   \n",
       "2 2007-08-06 08:48:40.010   39.4635  -111.2277   410.0       4.37   \n",
       "3 2007-08-07 21:42:51.130   39.4627  -111.2200  4620.0       1.65   \n",
       "4 2007-08-07 07:13:05.760   39.4605  -111.2242  3240.0       2.24   \n",
       "5 2007-08-07 02:05:04.490   39.4648  -111.2255  1790.0       2.08   \n",
       "6 2007-08-07 02:14:24.080   39.4632  -111.2230  4180.0       1.26   \n",
       "7 2007-08-07 03:44:18.470   39.4625  -111.2152  4160.0       1.45   \n",
       "\n",
       "  event_description  associated_phase_count  azimuthal_gap          event_id  \\\n",
       "0                LR                     0.0            NaN  smi:local/248828   \n",
       "1                LR                     0.0            NaN  smi:local/248843   \n",
       "2                LR                     0.0            NaN  smi:local/248839   \n",
       "3                                       0.0            NaN  smi:local/248925   \n",
       "4                                       0.0            NaN  smi:local/248891   \n",
       "5                LR                     0.0            NaN  smi:local/248882   \n",
       "6                LR                     0.0            NaN  smi:local/248883   \n",
       "7                LR                     0.0            NaN  smi:local/248887   \n",
       "\n",
       "   horizontal_uncertainty  ...  standard_error  used_phase_count  \\\n",
       "0                     NaN  ...          0.8936               0.0   \n",
       "1                     NaN  ...          0.8237               0.0   \n",
       "2                     NaN  ...          1.7356               0.0   \n",
       "3                     NaN  ...          0.5704               0.0   \n",
       "4                     NaN  ...          0.9901               0.0   \n",
       "5                     NaN  ...          0.9935               0.0   \n",
       "6                     NaN  ...          0.8834               0.0   \n",
       "7                     NaN  ...          0.5716               0.0   \n",
       "\n",
       "   station_count vertical_uncertainty                       updated  author  \\\n",
       "0           23.0                  NaN 2025-01-03 23:11:14.512233984      DC   \n",
       "1           29.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "2          134.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "3           19.0                  NaN 2025-01-03 23:11:14.514234112      DC   \n",
       "4           35.0                  NaN 2025-01-03 23:11:14.513233920           \n",
       "5           35.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "6           14.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "7           15.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "\n",
       "   agency_id              creation_time  version  \\\n",
       "0      NIOSH 2018-10-10 20:26:49.642650            \n",
       "1      NIOSH 2018-10-10 20:33:27.110914            \n",
       "2      NIOSH 2018-10-10 20:33:13.618111            \n",
       "3      NIOSH 2018-10-11 22:08:54.236916            \n",
       "4                                   NaT            \n",
       "5      NIOSH 2018-10-10 21:15:19.190404            \n",
       "6      NIOSH 2018-10-10 21:10:26.864045            \n",
       "7      NIOSH 2018-10-10 21:10:27.576204            \n",
       "\n",
       "                                       path  \n",
       "0  2007/08/06/2007-08-06T01-44-48_48828.xml  \n",
       "1  2007/08/06/2007-08-06T10-47-25_48843.xml  \n",
       "2  2007/08/06/2007-08-06T08-48-40_48839.xml  \n",
       "3  2007/08/07/2007-08-07T21-42-51_48925.xml  \n",
       "4  2007/08/07/2007-08-07T07-13-05_48891.xml  \n",
       "5  2007/08/07/2007-08-07T02-05-04_48882.xml  \n",
       "6  2007/08/07/2007-08-07T02-14-24_48883.xml  \n",
       "7  2007/08/07/2007-08-07T03-44-18_48887.xml  \n",
       "\n",
       "[8 rows x 28 columns]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "index = bank.read_index()\n",
    "index"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The index contains the following columns:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "If you are working from a data directory that doesn't have write access, you can specify a custom location for the index path:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:12.298790Z",
     "iopub.status.busy": "2025-01-03T23:13:12.298438Z",
     "iopub.status.idle": "2025-01-03T23:13:13.104711Z",
     "shell.execute_reply": "2025-01-03T23:13:13.104247Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>time</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>depth</th>\n",
       "      <th>magnitude</th>\n",
       "      <th>event_description</th>\n",
       "      <th>associated_phase_count</th>\n",
       "      <th>azimuthal_gap</th>\n",
       "      <th>event_id</th>\n",
       "      <th>horizontal_uncertainty</th>\n",
       "      <th>...</th>\n",
       "      <th>standard_error</th>\n",
       "      <th>used_phase_count</th>\n",
       "      <th>station_count</th>\n",
       "      <th>vertical_uncertainty</th>\n",
       "      <th>updated</th>\n",
       "      <th>author</th>\n",
       "      <th>agency_id</th>\n",
       "      <th>creation_time</th>\n",
       "      <th>version</th>\n",
       "      <th>path</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2007-08-06 01:44:48.810</td>\n",
       "      <td>39.4617</td>\n",
       "      <td>-111.2378</td>\n",
       "      <td>6570.0</td>\n",
       "      <td>1.78</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248828</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.8936</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.512233984</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 20:26:49.642650</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/06/2007-08-06T01-44-48_48828.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2007-08-06 10:47:25.600</td>\n",
       "      <td>39.4615</td>\n",
       "      <td>-111.2317</td>\n",
       "      <td>2050.0</td>\n",
       "      <td>1.57</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248843</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.8237</td>\n",
       "      <td>0.0</td>\n",
       "      <td>29.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 20:33:27.110914</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/06/2007-08-06T10-47-25_48843.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2007-08-06 08:48:40.010</td>\n",
       "      <td>39.4635</td>\n",
       "      <td>-111.2277</td>\n",
       "      <td>410.0</td>\n",
       "      <td>4.37</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248839</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>1.7356</td>\n",
       "      <td>0.0</td>\n",
       "      <td>134.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 20:33:13.618111</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/06/2007-08-06T08-48-40_48839.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2007-08-07 21:42:51.130</td>\n",
       "      <td>39.4627</td>\n",
       "      <td>-111.2200</td>\n",
       "      <td>4620.0</td>\n",
       "      <td>1.65</td>\n",
       "      <td></td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248925</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.5704</td>\n",
       "      <td>0.0</td>\n",
       "      <td>19.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.514234112</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-11 22:08:54.236916</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T21-42-51_48925.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2007-08-07 07:13:05.760</td>\n",
       "      <td>39.4605</td>\n",
       "      <td>-111.2242</td>\n",
       "      <td>3240.0</td>\n",
       "      <td>2.24</td>\n",
       "      <td></td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248891</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.9901</td>\n",
       "      <td>0.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>NaT</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T07-13-05_48891.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2007-08-07 02:05:04.490</td>\n",
       "      <td>39.4648</td>\n",
       "      <td>-111.2255</td>\n",
       "      <td>1790.0</td>\n",
       "      <td>2.08</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248882</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.9935</td>\n",
       "      <td>0.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 21:15:19.190404</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T02-05-04_48882.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2007-08-07 02:14:24.080</td>\n",
       "      <td>39.4632</td>\n",
       "      <td>-111.2230</td>\n",
       "      <td>4180.0</td>\n",
       "      <td>1.26</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248883</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.8834</td>\n",
       "      <td>0.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 21:10:26.864045</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T02-14-24_48883.xml</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2007-08-07 03:44:18.470</td>\n",
       "      <td>39.4625</td>\n",
       "      <td>-111.2152</td>\n",
       "      <td>4160.0</td>\n",
       "      <td>1.45</td>\n",
       "      <td>LR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>smi:local/248887</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.5716</td>\n",
       "      <td>0.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2025-01-03 23:11:14.513233920</td>\n",
       "      <td>DC</td>\n",
       "      <td>NIOSH</td>\n",
       "      <td>2018-10-10 21:10:27.576204</td>\n",
       "      <td></td>\n",
       "      <td>2007/08/07/2007-08-07T03-44-18_48887.xml</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>8 rows × 28 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                     time  latitude  longitude   depth  magnitude  \\\n",
       "0 2007-08-06 01:44:48.810   39.4617  -111.2378  6570.0       1.78   \n",
       "1 2007-08-06 10:47:25.600   39.4615  -111.2317  2050.0       1.57   \n",
       "2 2007-08-06 08:48:40.010   39.4635  -111.2277   410.0       4.37   \n",
       "3 2007-08-07 21:42:51.130   39.4627  -111.2200  4620.0       1.65   \n",
       "4 2007-08-07 07:13:05.760   39.4605  -111.2242  3240.0       2.24   \n",
       "5 2007-08-07 02:05:04.490   39.4648  -111.2255  1790.0       2.08   \n",
       "6 2007-08-07 02:14:24.080   39.4632  -111.2230  4180.0       1.26   \n",
       "7 2007-08-07 03:44:18.470   39.4625  -111.2152  4160.0       1.45   \n",
       "\n",
       "  event_description  associated_phase_count  azimuthal_gap          event_id  \\\n",
       "0                LR                     0.0            NaN  smi:local/248828   \n",
       "1                LR                     0.0            NaN  smi:local/248843   \n",
       "2                LR                     0.0            NaN  smi:local/248839   \n",
       "3                                       0.0            NaN  smi:local/248925   \n",
       "4                                       0.0            NaN  smi:local/248891   \n",
       "5                LR                     0.0            NaN  smi:local/248882   \n",
       "6                LR                     0.0            NaN  smi:local/248883   \n",
       "7                LR                     0.0            NaN  smi:local/248887   \n",
       "\n",
       "   horizontal_uncertainty  ...  standard_error  used_phase_count  \\\n",
       "0                     NaN  ...          0.8936               0.0   \n",
       "1                     NaN  ...          0.8237               0.0   \n",
       "2                     NaN  ...          1.7356               0.0   \n",
       "3                     NaN  ...          0.5704               0.0   \n",
       "4                     NaN  ...          0.9901               0.0   \n",
       "5                     NaN  ...          0.9935               0.0   \n",
       "6                     NaN  ...          0.8834               0.0   \n",
       "7                     NaN  ...          0.5716               0.0   \n",
       "\n",
       "   station_count vertical_uncertainty                       updated  author  \\\n",
       "0           23.0                  NaN 2025-01-03 23:11:14.512233984      DC   \n",
       "1           29.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "2          134.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "3           19.0                  NaN 2025-01-03 23:11:14.514234112      DC   \n",
       "4           35.0                  NaN 2025-01-03 23:11:14.513233920           \n",
       "5           35.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "6           14.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "7           15.0                  NaN 2025-01-03 23:11:14.513233920      DC   \n",
       "\n",
       "   agency_id              creation_time  version  \\\n",
       "0      NIOSH 2018-10-10 20:26:49.642650            \n",
       "1      NIOSH 2018-10-10 20:33:27.110914            \n",
       "2      NIOSH 2018-10-10 20:33:13.618111            \n",
       "3      NIOSH 2018-10-11 22:08:54.236916            \n",
       "4                                   NaT            \n",
       "5      NIOSH 2018-10-10 21:15:19.190404            \n",
       "6      NIOSH 2018-10-10 21:10:26.864045            \n",
       "7      NIOSH 2018-10-10 21:10:27.576204            \n",
       "\n",
       "                                       path  \n",
       "0  2007/08/06/2007-08-06T01-44-48_48828.xml  \n",
       "1  2007/08/06/2007-08-06T10-47-25_48843.xml  \n",
       "2  2007/08/06/2007-08-06T08-48-40_48839.xml  \n",
       "3  2007/08/07/2007-08-07T21-42-51_48925.xml  \n",
       "4  2007/08/07/2007-08-07T07-13-05_48891.xml  \n",
       "5  2007/08/07/2007-08-07T02-05-04_48882.xml  \n",
       "6  2007/08/07/2007-08-07T02-14-24_48883.xml  \n",
       "7  2007/08/07/2007-08-07T03-44-18_48887.xml  \n",
       "\n",
       "[8 rows x 28 columns]"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import tempfile\n",
    "from pathlib import Path\n",
    "\n",
    "index_path = Path(tempfile.mkdtemp()) / \"index.db\"\n",
    "cust_ind_bank = obsplus.EventBank(event_path, index_path=index_path)\n",
    "cust_ind_bank.update_index()\n",
    "ind = cust_ind_bank.read_index()\n",
    "ind  # Note that paths in the index are relative to event_path"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Get events\n",
    "The `EventBank` can be used to get obspy event objects based on query parameters."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:13.106438Z",
     "iopub.status.busy": "2025-01-03T23:13:13.106262Z",
     "iopub.status.idle": "2025-01-03T23:13:13.518627Z",
     "shell.execute_reply": "2025-01-03T23:13:13.518087Z"
    }
   },
   "outputs": [],
   "source": [
    "catalog = bank.get_events(minmagnitude=2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Put events\n",
    "Events can be saved to disk using the `put_events` method. If an event with the same resource_id already exists in the bank it will be overwritten."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:13.520708Z",
     "iopub.status.busy": "2025-01-03T23:13:13.520534Z",
     "iopub.status.idle": "2025-01-03T23:13:13.596250Z",
     "shell.execute_reply": "2025-01-03T23:13:13.595718Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "EventBank(base_path=/tmp/tmpk7ti2wd9/crandall_test/events, index_path=/tmp/tmpk7ti2wd9/crandall_test/events/.index.db)"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bank.put_events(obspy.read_events())"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Organizing event directories\n",
    "`EventBank` can also be used to (re)organize event directories. The events are saved in the following structure by default: `{year/month/day/year-month-dayThour-minute-second-short_id.xml}` (where \"short_id\" means the last 5 characters of the event id). \n",
    "\n",
    "The structure of the event directories can be reorganized to `{year/month/short_id.xml}`.  The following code demonstrates the process used in changing the event directory structure.\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:13.598137Z",
     "iopub.status.busy": "2025-01-03T23:13:13.597790Z",
     "iopub.status.idle": "2025-01-03T23:13:13.600642Z",
     "shell.execute_reply": "2025-01-03T23:13:13.600223Z"
    }
   },
   "outputs": [],
   "source": [
    "import tempfile\n",
    "from pathlib import Path\n",
    "\n",
    "temp_dir = Path(tempfile.mkdtemp())\n",
    "\n",
    "kwargs = dict(\n",
    "    path_structure=\"{year}/{month}\",\n",
    "    name_structure=\"{event_id_short}\",\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-01-03T23:13:13.602146Z",
     "iopub.status.busy": "2025-01-03T23:13:13.601899Z",
     "iopub.status.idle": "2025-01-03T23:13:15.065660Z",
     "shell.execute_reply": "2025-01-03T23:13:15.065227Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "EventBank(base_path=/tmp/tmpkggv2ixy, index_path=/tmp/tmpkggv2ixy/.index.db)"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bank2 = obsplus.EventBank(temp_dir, **kwargs)\n",
    "bank2.put_events(bank)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Notes\n",
    "Unlike the [WaveBank](wavebank.pynb), which uses HDF5 to index waveforms, EventBank uses a [SQLite](https://www.sqlite.org/index.html) which is more suitable for frequent updates and [CRUD](https://en.wikipedia.org/wiki/Create,_read,_update_and_delete) usage patterns."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
